import{j as e,b as R,y as J,z as W,A as K,D,G as V,J as Z,K as A,N as G,O as Q,Q as Y,Y as ee}from"./ui-vendor-DzdBeN5K.js";import{r as c}from"./react-vendor-NlGWQ5oO.js";import{S as te,s as N}from"./index-DlGcFboI.js";import"./supabase-vendor-DmmNYjRx.js";const ce=()=>{const[s,u]=c.useState([]),[y,C]=c.useState(!0),[x,j]=c.useState(null);c.useEffect(()=>{(async()=>{const{data:{user:i}}=await N.auth.getUser();if(i){const{data:h}=await N.from("profiles").select("*").eq("id",i.id).single();j(h)}})()},[]),c.useEffect(()=>{(async()=>{try{const{data:i,error:h}=await N.from("posts").select(`
            *,
            profiles: user_id (id, username, full_name, avatar_url)
          `).order("created_at",{ascending:!0}).limit(20);if(h)throw h;const{data:{user:m}}=await N.auth.getUser(),v=await Promise.all((i||[]).map(async f=>{const[g,L,l]=await Promise.all([N.from("likes").select("*",{count:"exact",head:!0}).eq("post_id",f.id),N.from("comments").select("*",{count:"exact",head:!0}).eq("post_id",f.id),m?N.from("likes").select("id").eq("post_id",f.id).eq("user_id",m.id).maybeSingle():Promise.resolve({data:null})]);return{...f,author:f.profiles||null,likesCount:g.count||0,commentsCount:L.count||0,userLiked:!!l.data}}));u(v)}catch{}finally{C(!1)}})()},[]);const S=async o=>{if(!x){alert("Please log in to like posts");return}try{const{data:i}=await N.from("likes").select("id").eq("post_id",o).eq("user_id",x.id).maybeSingle();i?(await N.from("likes").delete().eq("post_id",o).eq("user_id",x.id),u(h=>h.map(m=>m.id===o?{...m,likesCount:m.likesCount-1,userLiked:!1}:m))):(await N.from("likes").insert({post_id:o,user_id:x.id}),u(h=>h.map(m=>m.id===o?{...m,likesCount:m.likesCount+1,userLiked:!0}:m)))}catch{}},M=async o=>{const i=`${window.location.origin}/blog/post/${o.id}`,h={title:o.title||"Check out this post",text:o.content?o.content.substring(0,150)+(o.content.length>150?"...":""):"Check out this interesting post",url:i};if(navigator.share)try{await navigator.share(h),b()}catch(m){if(m instanceof Error&&m.name==="AbortError")return;await _(i)}else await _(i)},b=()=>{const o=document.createElement("div");o.className="share-success-toast",o.innerHTML=`
      <div class="share-success-content">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 2L11 13"></path>
          <path d="M22 2L15 22 11 13 2 9 22 2Z"></path>
        </svg>
        <span>Post shared successfully!</span>
      </div>
    `,document.body.appendChild(o),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},3e3)},_=async o=>{try{await navigator.clipboard.writeText(o),b();const i=document.createElement("div");i.className="share-success-toast clipboard-toast",i.innerHTML=`
        <div class="share-success-content">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 4h.01"></path>
            <path d="M16 20h.01"></path>
            <path d="M8 8h.01"></path>
            <path d="M8 16h.01"></path>
            <rect x="4" y="4" width="16" height="16" rx="2"></rect>
            <path d="M9 12l2 2 4-4"></path>
          </svg>
          <span>Link copied to clipboard!</span>
        </div>
      `,document.body.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},3e3)}catch{alert(`Share this link: ${o}`)}};return e.jsxs("div",{className:"blog-page",children:[e.jsx(te,{}),e.jsx("main",{className:"post-content",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"posts-feed",children:y?e.jsx("div",{className:"loading-spinner"}):s.length===0?e.jsx("p",{className:"no-posts",children:"No posts available."}):s.map(o=>e.jsx(ae,{post:o,currentUser:x,onLike:S,onShare:M},o.id))})})})]})},se=({videoUrl:s,poster:u})=>{const[y,C]=c.useState(!1),[x,j]=c.useState(!1),[S,M]=c.useState(!0),[b,_]=c.useState(0),[o,i]=c.useState(0),[h,m]=c.useState(!1),v=c.useRef(null),f=c.useRef(null),g=c.useRef(null);c.useEffect(()=>{const a=v.current;if(!a)return;const p=()=>_(a.duration),w=()=>i(a.currentTime),I=()=>{C(!1),j(!0)};return a.addEventListener("loadedmetadata",p),a.addEventListener("timeupdate",w),a.addEventListener("ended",I),()=>{a.removeEventListener("loadedmetadata",p),a.removeEventListener("timeupdate",w),a.removeEventListener("ended",I)}},[]);const L=async()=>{const a=v.current;if(a)try{y?(a.pause(),C(!1)):(await a.play(),C(!0),j(!0),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{j(!1)},3e3))}catch{if(!S){a.muted=!0,M(!0);try{await a.play(),C(!0),j(!0)}catch{}}}},l=()=>{const a=v.current;a&&(a.muted=!a.muted,M(a.muted))},$=a=>{const p=v.current;if(!p)return;const w=a.currentTarget.getBoundingClientRect(),T=(a.clientX-w.left)/w.width*b;p.currentTime=T,i(T)},F=()=>{const a=f.current;a&&(h?document.exitFullscreen&&document.exitFullscreen():a.requestFullscreen&&a.requestFullscreen(),m(!h))},E=a=>{const p=Math.floor(a/60),w=Math.floor(a%60);return`${p}:${w.toString().padStart(2,"0")}`};return e.jsxs("div",{ref:f,className:"facebook-video-player",onMouseEnter:()=>j(!0),onMouseLeave:()=>{y&&g.current&&clearTimeout(g.current),y||j(!1)},onClick:a=>{(a.target===a.currentTarget||a.target===v.current)&&j(!0)},children:[e.jsx("video",{ref:v,src:s,poster:u,preload:"metadata",playsInline:!0,muted:S,crossOrigin:"anonymous",className:"facebook-video-element",onError:a=>{const p=a.currentTarget;p.src!==s&&(p.src=s,p.load())}}),!y&&e.jsx("div",{className:"video-play-overlay",onClick:L,children:e.jsx("div",{className:"play-button",children:e.jsx(A,{size:60,fill:"white",stroke:"white",strokeWidth:1})})}),e.jsxs("div",{className:`video-controls ${x?"visible":""}`,children:[e.jsxs("div",{className:"progress-container",onClick:$,children:[e.jsx("div",{className:"progress-bar",style:{width:b>0?`${o/b*100}%`:"0%"}}),e.jsx("div",{className:"progress-background"})]}),e.jsxs("div",{className:"control-buttons",children:[e.jsx("button",{className:"control-btn play-pause",onClick:L,children:y?e.jsx(G,{size:24}):e.jsx(A,{size:24})}),e.jsxs("div",{className:"time-display",children:[e.jsx("span",{className:"current-time",children:E(o)}),e.jsx("span",{className:"time-separator",children:"/"}),e.jsx("span",{className:"duration",children:E(b)})]}),e.jsx("button",{className:"control-btn volume",onClick:l,children:S?e.jsx(Q,{size:24}):e.jsx(Y,{size:24})}),e.jsx("button",{className:"control-btn fullscreen",onClick:F,children:e.jsx(ee,{size:24})})]})]})]})},ae=({post:s,currentUser:u,onLike:y,onShare:C})=>{const[x,j]=c.useState(!1),[S,M]=c.useState([]),[b,_]=c.useState(""),[o,i]=c.useState(0),[h,m]=c.useState(!1),[v,f]=c.useState(0),[g,L]=c.useState(!1),l=s.image_url?JSON.parse(s.image_url):[],$=l.length>1,E=(t=>{if(!t)return[];try{const n=JSON.parse(t);return Array.isArray(n)?n:[n]}catch{return[t]}})(s.video_url),a=E.length>0,p=t=>{try{const r=new URL(t).pathname.toLowerCase();return/\.(mp4|webm|ogg|avi|mov|wmv|flv|m4v|3gp)$/i.test(r)}catch{return!1}},w=t=>{if(p(t))return!1;try{const r=new URL(t).hostname.toLowerCase();return r.includes("youtube.com")||r.includes("youtu.be")||r.includes("vimeo.com")||r.includes("dailymotion.com")||r.includes("tiktok.com")||r.includes("instagram.com")||r.includes("facebook.com")||r.includes("twitter.com")||r.includes("x.com")}catch{return!1}},I=t=>{try{const n=new URL(t),r=n.hostname.toLowerCase();if(r.includes("youtube.com")||r.includes("youtu.be")){let d=n.searchParams.get("v");if(!d&&r.includes("youtu.be"))d=n.pathname.split("/").pop()||null;else if(!d){const k=n.pathname.match(/\/(?:watch|embed)\/([^/?]+)/);k&&(d=k[1])}if(d)return`https://www.youtube.com/embed/${d}?autoplay=0&enablejsapi=1&modestbranding=1&rel=0`}if(r.includes("vimeo.com")){const d=n.pathname.split("/").pop();if(d&&/^\d+$/.test(d))return`https://player.vimeo.com/video/${d}?autoplay=0`}if(r.includes("tiktok.com")){const d=n.pathname.split("/"),k=d.findIndex(z=>z==="video");if(k!==-1&&d[k+1])return`https://www.tiktok.com/embed/${d[k+1]}`}if(r.includes("instagram.com")&&(n.pathname.includes("/reel/")||n.pathname.includes("/p/")))return`https://www.instagram.com${n.pathname}/embed/`;if(r.includes("facebook.com")&&n.pathname.includes("/videos/"))return`https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(t)}&show_text=false`;if(r.includes("twitter.com")||r.includes("x.com")){const d=n.pathname.match(/\/status\/(\d+)/);if(d)return`https://platform.twitter.com/embed/Tweet.html?id=${d[1]}`}if(r.includes("dailymotion.com")){const d=n.pathname.match(/\/video\/([a-zA-Z0-9]+)/);if(d)return`https://www.dailymotion.com/embed/video/${d[1]}`}return""}catch{return""}},P=c.useCallback(async()=>{try{const{data:t,error:n}=await N.from("comments").select(`
          *,
          profiles: user_id (username, full_name, avatar_url)
        `).eq("post_id",s.id).order("created_at",{ascending:!0});if(n)throw n;M(t||[])}catch{}},[s.id]);c.useEffect(()=>{x&&P()},[x,P]);const T=async()=>{if(!(!u||!b.trim()))try{const{error:t}=await N.from("comments").insert({post_id:s.id,user_id:u.id,content:b.trim()});if(t)throw t;_(""),P()}catch{}},O=()=>{i(t=>(t+1)%l.length)},U=()=>{i(t=>(t-1+l.length)%l.length)},B=(t=0)=>{f(t),m(!0)},q=()=>{m(!1)},X=()=>{f(t=>(t+1)%l.length)},H=()=>{f(t=>(t-1+l.length)%l.length)};return e.jsxs("article",{className:"facebook-post-card",children:[e.jsx("div",{className:"post-header",children:e.jsxs("div",{className:"author-info",children:[e.jsx("div",{className:"author-avatar",children:s.author?.avatar_url?e.jsx("img",{src:s.author.avatar_url,alt:s.author.username}):e.jsx(R,{size:32})}),e.jsxs("div",{className:"author-details",children:[e.jsx("h3",{className:"author-name",children:s.author?.full_name||s.author?.username||"Anonymous"}),e.jsxs("span",{className:"post-time",children:[e.jsx(J,{size:14}),new Date(s.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}),e.jsxs("div",{className:"post-content",children:[s.title&&e.jsx("h4",{className:"post-title",children:s.title}),e.jsxs("div",{className:"post-text-container",children:[e.jsxs("div",{className:`post-text-wrapper ${g?"":"truncated"}`,children:[e.jsx("p",{className:"post-text",children:s.content}),!g&&s.content&&s.content.length>100&&e.jsx("button",{className:"read-more-btn",onClick:()=>L(!g),children:"Read More"})]}),g&&s.content&&s.content.length>100&&e.jsx("button",{className:"read-more-btn read-less-btn",onClick:()=>L(!g),children:"Read Less"})]})]}),l.length>0&&e.jsx("div",{className:"post-media",children:e.jsxs("div",{className:"media-container",children:[e.jsx("img",{src:l[o],alt:`Post media ${o+1}`,className:"post-media-image",onClick:()=>B(o),style:{cursor:"pointer"}}),$&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:U,children:e.jsx(W,{size:24})}),e.jsx("button",{className:"media-nav next",onClick:O,children:e.jsx(K,{size:24})}),e.jsx("div",{className:"image-indicators",children:l.map((t,n)=>e.jsx("button",{className:`indicator ${n===o?"active":""}`,onClick:()=>i(n)},n))}),e.jsxs("div",{className:"image-counter",children:[o+1," / ",l.length]})]})]})}),a&&e.jsx("div",{className:"post-media",children:E.map((t,n)=>{const r=p(t),k=w(t)?I(t):"";return e.jsx("div",{className:"post-video-container",children:r?e.jsx(se,{videoUrl:t,poster:l.length>0?l[0]:void 0,index:n}):k?e.jsxs("div",{className:"external-video-wrapper",children:[e.jsx("iframe",{src:k,className:"post-media-video",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:`Video ${n+1}`,onLoad:()=>{},onError:z=>{}}),e.jsx("div",{style:{position:"absolute",bottom:"5px",right:"5px",background:"rgba(0,0,0,0.7)",color:"white",padding:"2px 6px",borderRadius:"3px",fontSize:"10px",zIndex:10},children:"External Video"})]}):e.jsx("div",{className:"video-error",children:"Unable to load video. Unsupported URL format."})},n)})}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"post-tags",children:s.tags.map((t,n)=>e.jsxs("span",{className:"tag",children:["#",t]},n))}),e.jsx("div",{className:"post-stats",children:e.jsxs("div",{className:"stats-info",children:[s.likesCount>0&&e.jsxs("span",{className:"likes-count",children:[e.jsx(D,{size:16,fill:"currentColor"}),s.likesCount]}),u&&s.commentsCount>0&&e.jsxs("span",{className:"comments-count",onClick:()=>j(!x),children:[s.commentsCount," comments"]}),!u&&s.commentsCount>0&&e.jsxs("span",{className:"comments-count disabled",children:[s.commentsCount," comments"]})]})}),e.jsxs("div",{className:"post-actions",children:[e.jsxs("button",{className:`action-btn like ${s.userLiked?"liked":""}`,onClick:()=>y(s.id),children:[e.jsx(D,{size:18,fill:s.userLiked?"currentColor":"none"}),"Like"]}),u?e.jsxs("button",{className:"action-btn comment",onClick:()=>j(!x),children:[e.jsx(V,{size:18}),"Comment"]}):e.jsxs("button",{className:"action-btn comment disabled",onClick:()=>alert("Please log in to view comments"),children:[e.jsx(V,{size:18}),"Comment"]}),e.jsxs("button",{className:"action-btn share",onClick:()=>C(s),children:[e.jsx(Z,{size:18}),"Share"]})]}),x&&u&&e.jsxs("div",{className:"comments-section",children:[e.jsx("div",{className:"comments-list",children:S.map(t=>e.jsxs("div",{className:"comment",children:[e.jsx("div",{className:"comment-avatar",children:t.profiles?.avatar_url?e.jsx("img",{src:t.profiles.avatar_url,alt:t.profiles.username}):e.jsx(R,{size:24})}),e.jsxs("div",{className:"comment-content",children:[e.jsxs("div",{className:"comment-bubble",children:[e.jsx("strong",{children:t.profiles?.full_name||t.profiles?.username||"Anonymous"}),e.jsx("p",{children:t.content})]}),e.jsx("span",{className:"comment-time",children:new Date(t.created_at).toLocaleDateString()})]})]},t.id))}),e.jsxs("div",{className:"add-comment",children:[e.jsx("div",{className:"comment-avatar",children:u.avatar_url?e.jsx("img",{src:u.avatar_url,alt:u.username}):e.jsx(R,{size:24})}),e.jsxs("div",{className:"comment-input-container",children:[e.jsx("input",{type:"text",value:b,onChange:t=>_(t.target.value),placeholder:"Write a comment...",onKeyDown:t=>t.key==="Enter"&&T()}),e.jsx("button",{onClick:T,disabled:!b.trim(),className:"post-comment-btn",children:"Post"})]})]})]}),h&&e.jsx("div",{className:"image-modal-overlay",onClick:q,children:e.jsxs("div",{className:"image-modal-content",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{className:"modal-close-btn",onClick:q,children:"×"}),e.jsxs("div",{className:"modal-image-container",children:[e.jsx("img",{src:l[v],alt:`Modal image ${v+1}`,className:"modal-image"}),l.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"modal-nav prev",onClick:H,children:"‹"}),e.jsx("button",{className:"modal-nav next",onClick:X,children:"›"}),e.jsx("div",{className:"modal-indicators",children:l.map((t,n)=>e.jsx("button",{className:`modal-indicator ${n===v?"active":""}`,onClick:()=>f(n)},n))}),e.jsxs("div",{className:"modal-counter",children:[v+1," / ",l.length]})]})]})]})})]})};export{ce as default};
