import{j as e,X as se,r as oe,s as te,i as ae,t as W,u as ce,v as pe,w as ve,n as je,S as ne,c as de,d as ue,x as Ne,e as be,f as Q,y as we,z as Ce,A as ke,D as Se,G as ie,J as re,K as ye,N as le,O as Ee,Q as _e,Y as Le,Z as ze}from"./ui-vendor-CGRqESeM.js";import{r as a,j as Me,L as me}from"./react-vendor-CgVTdkFV.js";import{s as w,R as he}from"./index-El7sF2ch.js";import"./supabase-vendor-DXEREdEf.js";const Pe=({isOpen:n,onClose:g})=>{const[u,M]=a.useState(!0),[h,y]=a.useState(""),[N,L]=a.useState(""),[p,V]=a.useState(""),[v,E]=a.useState(""),[z,b]=a.useState(!1),[c,f]=a.useState(!1),[C,m]=a.useState(null),[d,P]=a.useState(null),[T,U]=a.useState(null),[r,_]=a.useState(!1),[s,t]=a.useState(null),[k,j]=a.useState(!1),[D,A]=a.useState(null),[R,q]=a.useState(!1),[F,Z]=a.useState({score:0,feedback:[],color:"#ef4444"}),i=l=>l.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)?{isValid:!0,message:""}:{isValid:!1,message:"Please enter a valid email address"}:{isValid:!1,message:"Email is required"},o=l=>l.trim()?l.trim().length<3?{isValid:!1,message:"Username must be at least 3 characters long"}:/^[a-zA-Z0-9_]+$/.test(l)?{isValid:!0,message:""}:{isValid:!1,message:"Username can only contain letters, numbers, and underscores"}:{isValid:!1,message:"Username is required"},x=l=>l.trim()?{isValid:!0,message:""}:{isValid:!1,message:"Full name is required"},S=l=>{const O=[],ee=[{test:l.length>=8,label:"At least 8 characters"},{test:/[a-z]/.test(l),label:"One lowercase letter"},{test:/[A-Z]/.test(l),label:"One uppercase letter"},{test:/\d/.test(l),label:"One number"},{test:/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>?/]/.test(l),label:"One special character"}];let B=0;ee.forEach($=>{$.test?B+=1:O.push($.label)});let H="#ef4444";return B>=4?H="#10b981":B>=2&&(H="#3b82f6"),{score:B,feedback:O,color:H}},I=a.useCallback(l=>{f(!0),setTimeout(()=>{P("Google authentication successful!"),f(!1),setTimeout(()=>{g(),Y()},1500)},1e3)},[g]);a.useEffect(()=>{window.google?.accounts?.id&&window.google.accounts.id.initialize({client_id:"331811061779-qhmm4q1lo85jgd8h5joeeutpakegvide.apps.googleusercontent.com",callback:I})},[I]);const K=()=>{window.google?.accounts?.id?window.google.accounts.id.prompt():I({credential:"simulated"})};a.useEffect(()=>{if(h){const l=i(h);U(l.isValid?null:l.message),_(l.isValid)}else U(null),_(!1)},[h]),a.useEffect(()=>{if(N){const l=S(N);Z(l)}else Z({score:0,feedback:[],color:"#ef4444"})},[N]),a.useEffect(()=>{if(v&&!u){const l=o(v);t(l.isValid?null:l.message),j(l.isValid)}else t(null),j(!1)},[v,u]),a.useEffect(()=>{if(p&&!u){const l=x(p);A(l.isValid?null:l.message),q(l.isValid)}else A(null),q(!1)},[p,u]);const fe=async l=>{l.preventDefault(),f(!0),m(null),P(null);const O=i(h),ee=F.score>=4,B=u?{isValid:!0,message:""}:o(v),H=u?{isValid:!0,message:""}:x(p);if(!O.isValid){m(O.message),f(!1);return}if(!ee){m("Please ensure your password meets all requirements"),f(!1);return}if(!B.isValid){m(B.message),f(!1);return}if(!H.isValid){m(H.message),f(!1);return}try{if(u){const{data:$,error:X}=await w.auth.signInWithPassword({email:h.trim(),password:N});if(X){m(X.message),f(!1);return}if($.user){const{error:G}=await w.from("profiles").select("id").eq("id",$.user.id).single();if(G&&G.code==="PGRST116"){const{error:J}=await w.from("profiles").insert({id:$.user.id,username:($.user.user_metadata?.username||h.split("@")[0]).trim(),email:$.user.email?.trim(),full_name:($.user.user_metadata?.full_name||"").trim(),bio:"",avatar_url:"",role:"user"})}P("Login successful!"),setTimeout(()=>{g(),Y()},1500)}}else{const{data:$,error:X}=await w.from("profiles").select("username").eq("username",v.trim()).single();if(X&&X.code!=="PGRST116"){m("Error checking username availability"),f(!1);return}if($){m("Username is already taken. Please choose a different one."),f(!1);return}const{data:G,error:J}=await w.auth.signUp({email:h.trim(),password:N,options:{data:{username:v.trim(),full_name:p.trim(),email:h.trim()}}});if(J){m(J.message),f(!1);return}if(G.user){const{error:xe}=await w.from("profiles").insert({id:G.user.id,username:v.trim(),email:G.user.email||h.trim(),full_name:G.user.user_metadata?.full_name||p.trim(),bio:"",avatar_url:"",role:"user"});P("Signup successful! Please check your email to confirm your account."),M(!0),setTimeout(()=>{Y()},3e3)}}}catch{m("An unexpected error occurred")}finally{f(!1)}},Y=()=>{y(""),L(""),V(""),E(""),m(null),P(null)},ge=()=>{M(!u),m(null),P(null)};return n?e.jsx("div",{className:"modal-overlay",onClick:g,children:e.jsxs("div",{className:"modal-content",onClick:l=>l.stopPropagation(),children:[e.jsx("button",{className:"close-button",onClick:g,children:e.jsx(se,{size:20})}),e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:u?"Welcome Back":"Join Our Community"}),e.jsx("p",{children:u?"Sign in to your account":"Create your account"})]}),C&&e.jsx("div",{className:"error-message",children:C}),d&&e.jsx("div",{className:"success-message",children:d}),e.jsxs("div",{className:"google-auth-section",children:[e.jsxs("button",{type:"button",className:"google-auth-button",onClick:K,disabled:c,children:[e.jsxs("svg",{className:"google-icon",viewBox:"0 0 24 24",width:"20",height:"20",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]}),e.jsx("div",{className:"divider",children:e.jsx("span",{children:"or"})})]}),e.jsxs("form",{onSubmit:fe,className:"auth-form",children:[!u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"input-group",children:[e.jsx(oe,{className:"input-icon",size:20}),e.jsx("input",{type:"text",placeholder:"Username",value:v,onChange:l=>E(l.target.value),required:!u,className:`auth-input ${s?"error":k?"success":""} ${k?"input-valid":s?"input-invalid":""}`,style:{borderColor:v?k?"#10b981":s?"#ef4444":void 0:void 0},disabled:c}),s&&e.jsxs("div",{className:"field-error",children:[e.jsx(te,{size:16}),e.jsx("span",{children:s})]}),k&&!s&&e.jsxs("div",{className:"field-success",children:[e.jsx(ae,{size:16}),e.jsx("span",{children:"Username looks good!"})]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx(W,{className:"input-icon",size:20}),e.jsx("input",{type:"text",placeholder:"Full Name",value:p,onChange:l=>V(l.target.value),required:!u,className:`auth-input ${D?"error":R?"success":""} ${R?"input-valid":D?"input-invalid":""}`,style:{borderColor:p?R?"#10b981":D?"#ef4444":void 0:void 0},disabled:c}),D&&e.jsxs("div",{className:"field-error",children:[e.jsx(te,{size:16}),e.jsx("span",{children:D})]}),R&&!D&&e.jsxs("div",{className:"field-success",children:[e.jsx(ae,{size:16}),e.jsx("span",{children:"Full name looks good!"})]})]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx(ce,{className:"input-icon",size:20}),e.jsx("input",{type:"email",placeholder:"Email Address",value:h,onChange:l=>y(l.target.value),required:!0,className:`auth-input ${T?"error":r?"success":""} ${r?"input-valid":T?"input-invalid":""}`,style:{borderColor:h?r?"#10b981":T?"#ef4444":void 0:void 0},disabled:c})]}),e.jsxs("div",{className:"input-group",children:[e.jsx(pe,{className:"input-icon",size:20}),e.jsx("input",{type:z?"text":"password",placeholder:"Password",value:N,onChange:l=>L(l.target.value),required:!0,className:"auth-input",style:{borderColor:N?F.color:void 0},disabled:c}),e.jsx("button",{type:"button",className:"password-toggle",onClick:()=>b(!z),disabled:c,children:z?e.jsx(ve,{size:20}):e.jsx(je,{size:20})})]}),e.jsx("button",{type:"submit",className:"auth-button primary",disabled:c||!!T||F.score<4||!u&&(!!s||!!D),children:c?"Processing...":u?"Sign In":"Sign Up"})]}),e.jsx("div",{className:"auth-switch",children:e.jsxs("p",{children:[u?"Don't have an account? ":"Already have an account? ",e.jsx("button",{type:"button",className:"switch-button",onClick:ge,disabled:c,children:u?"Sign Up":"Sign In"})]})})]})}):null},Ie=()=>{const[n,g]=a.useState(null),[u,M]=a.useState(!0),[h,y]=a.useState(!1),{isDarkMode:N,toggleTheme:L}=he(),p=a.useRef(null),V=Me();if(a.useEffect(()=>{(async()=>{const{data:{user:f}}=await w.auth.getUser();if(f){const{data:C,error:m}=await w.from("profiles").select("id, username, full_name, email, avatar_url, role").eq("id",f.id).single();!m&&C&&g(C)}M(!1)})();const{data:{subscription:c}}=w.auth.onAuthStateChange(async(f,C)=>{if(C?.user){const{data:m,error:d}=await w.from("profiles").select("id, username, full_name, email, avatar_url, role").eq("id",C.user.id).single();g(!d&&m?m:null)}else g(null);M(!1)});return()=>c.unsubscribe()},[]),a.useEffect(()=>{const b=c=>{p.current&&!p.current.contains(c.target)&&y(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[]),u)return e.jsx("div",{className:"user-avatar loading",children:"..."});if(!n)return null;const v=(n.full_name||n.username||"U").split(" ").map(b=>b[0]).join("").toUpperCase().slice(0,2),E=()=>y(!h),z=async()=>{await w.auth.signOut(),y(!1)};return e.jsxs("div",{className:"user-avatar-container",ref:p,children:[e.jsxs("button",{className:"avatar-button",onClick:E,children:[n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.username,className:"avatar-image"}):e.jsx("div",{className:"avatar-initials",children:v}),n.role==="admin"&&e.jsx("div",{className:"admin-indicator",children:"A"})]}),h&&e.jsxs("div",{className:"dropdown-menu",children:[e.jsx("div",{className:"dropdown-header",children:e.jsxs("div",{className:"user-info",children:[e.jsxs("div",{className:"info-item",children:[e.jsx(oe,{size:14,className:"info-icon"}),e.jsxs("div",{className:"info-content",children:[e.jsx("span",{className:"info-label",children:"Username"}),e.jsx("span",{className:"info-value",children:n.username})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx(W,{size:14,className:"info-icon"}),e.jsxs("div",{className:"info-content",children:[e.jsx("span",{className:"info-label",children:"Full Name"}),e.jsx("span",{className:"info-value",children:n.full_name||"Not set"})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx(ce,{size:14,className:"info-icon"}),e.jsxs("div",{className:"info-content",children:[e.jsx("span",{className:"info-label",children:"Email"}),e.jsx("span",{className:"info-value",children:n.email||"Not set"})]})]}),e.jsxs("div",{className:"info-item",children:[e.jsx(ne,{size:14,className:"info-icon"}),e.jsxs("div",{className:"info-content",children:[e.jsx("span",{className:"info-label",children:"Role"}),e.jsx("span",{className:"info-value",children:n.role||"user"})]})]})]})}),e.jsx("div",{className:"dropdown-divider"}),e.jsxs("button",{className:"dropdown-item theme-toggle",onClick:()=>{L()},children:[N?e.jsx(de,{size:16}):e.jsx(ue,{size:16}),N?"Switch to Light Mode":"Switch to Dark Mode"]}),e.jsx("div",{className:"dropdown-divider"}),n.role==="admin"&&e.jsxs(me,{to:"/admin",className:"dropdown-item admin-link",children:[e.jsx(ne,{size:16}),"Admin Dashboard"]}),e.jsxs("button",{className:"dropdown-item",onClick:()=>{y(!1),V("/settings")},children:[e.jsx(Ne,{size:16}),"Settings"]}),e.jsxs("button",{className:"dropdown-item sign-out",onClick:z,children:[e.jsx(be,{size:16}),"Sign Out"]})]})]})},Ve=({showSearch:n=!1,searchQuery:g="",onSearchChange:u,onSearchKeyDown:M,onSearchBlur:h,showSuggestions:y=!1,onSuggestionClick:N,filteredSuggestions:L=[],selectedSuggestionIndex:p=-1,onSuggestionMouseEnter:V,onClearSearch:v})=>{const[E,z]=a.useState(!1),[b,c]=a.useState(null),{isDarkMode:f,toggleTheme:C}=he();return a.useEffect(()=>{(async()=>{const{data:{user:P}}=await w.auth.getUser();c(P)})();const{data:{subscription:d}}=w.auth.onAuthStateChange((P,T)=>{c(T?.user||null)});return()=>d.unsubscribe()},[]),e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"header",children:e.jsxs("div",{className:"header-content",children:[e.jsx(me,{to:"/",className:"navbar-logo",children:e.jsx("img",{src:"https://res.cloudinary.com/dpzndrhse/image/upload/v1750667944/efieplans_logo_edited_kq1tmo.avif",alt:"Efie plans Construction Logo",className:"navbar-logo-image"})}),n&&e.jsx("div",{className:"header-search-container",children:e.jsxs("div",{className:"header-search",children:[e.jsx(Q,{size:20,className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search posts...",value:g,onChange:u,onKeyDown:M,onBlur:h,className:"header-search-input",autoComplete:"off"}),g&&e.jsx("button",{className:"clear-search-btn",onClick:v,"aria-label":"Clear search",children:e.jsx(se,{size:16})}),y&&L.length>0&&e.jsx("div",{className:"header-suggestions-dropdown",children:L.map((m,d)=>e.jsxs("button",{className:`suggestion-item ${d===p?"selected":""}`,onClick:()=>N?.(m),onMouseEnter:()=>V?.(d),children:[e.jsx(Q,{size:14}),e.jsx("span",{children:m})]},m))})]})}),e.jsx("div",{className:"header-actions",children:b?e.jsx("div",{className:"user-section",children:e.jsx(Ie,{})}):e.jsxs("div",{className:"header-controls",children:[e.jsx("button",{className:"theme-toggle-btn",onClick:()=>{C()},title:f?"Switch to Light Mode":"Switch to Dark Mode",children:f?e.jsx(de,{size:20}):e.jsx(ue,{size:20})}),e.jsxs("button",{className:"auth-button",onClick:()=>z(!0),children:[e.jsx(we,{size:20}),e.jsx("span",{children:"Get Started"})]})]})})]})}),e.jsx(Pe,{isOpen:E,onClose:()=>z(!1)})]})},qe=()=>{const[n,g]=a.useState([]),[u,M]=a.useState(!0),[h,y]=a.useState(null),[N,L]=a.useState(""),[p,V]=a.useState([]),[v,E]=a.useState(!1),[z,b]=a.useState(-1);a.useEffect(()=>{(async()=>{const{data:{user:t}}=await w.auth.getUser();if(t){const{data:k}=await w.from("profiles").select("*").eq("id",t.id).single();y(k)}})()},[]),a.useEffect(()=>{(async()=>{try{const{data:t,error:k}=await w.from("posts").select(`
            *,
            profiles: user_id (id, username, full_name, avatar_url)
          `).order("created_at",{ascending:!0}).limit(20);if(k)throw k;const{data:{user:j}}=await w.auth.getUser(),D=await Promise.all((t||[]).map(async A=>{const[R,q,F]=await Promise.all([w.from("likes").select("*",{count:"exact",head:!0}).eq("post_id",A.id),w.from("comments").select("*",{count:"exact",head:!0}).eq("post_id",A.id),j?w.from("likes").select("id").eq("post_id",A.id).eq("user_id",j.id).maybeSingle():Promise.resolve({data:null})]);return{...A,author:A.profiles||null,likesCount:R.count||0,commentsCount:q.count||0,userLiked:!!F.data}}));g(D)}catch{}finally{M(!1)}})()},[]),a.useEffect(()=>{if(n.length>0){const s=new Set;n.forEach(t=>{t.title&&s.add(t.title),t.author?.username&&s.add(t.author.username),t.author?.full_name&&s.add(t.author.full_name),t.tags?.forEach(k=>s.add(k)),t.category&&s.add(t.category)}),["architectural design","construction","interior design"].forEach(t=>s.add(t)),V(Array.from(s).sort())}},[n]);const c=p.filter(s=>s.toLowerCase().includes(N.toLowerCase())&&s.toLowerCase()!==N.toLowerCase()).slice(0,8),f=n.filter(s=>{const t=N.toLowerCase().trim();return!t||s.title?.toLowerCase().includes(t)||s.content?.toLowerCase().includes(t)||s.author?.username?.toLowerCase().includes(t)||s.author?.full_name?.toLowerCase().includes(t)||s.category?.toLowerCase().includes(t)||s.tags?.some(j=>j.toLowerCase().includes(t))}),C=async s=>{if(!h){alert("Please log in to like posts");return}try{const{data:t}=await w.from("likes").select("id").eq("post_id",s).eq("user_id",h.id).maybeSingle();t?(await w.from("likes").delete().eq("post_id",s).eq("user_id",h.id),g(k=>k.map(j=>j.id===s?{...j,likesCount:j.likesCount-1,userLiked:!1}:j))):(await w.from("likes").insert({post_id:s,user_id:h.id}),g(k=>k.map(j=>j.id===s?{...j,likesCount:j.likesCount+1,userLiked:!0}:j)))}catch{}},m=s=>{const t=s.target.value;L(t),E(t.length>0),b(-1)},d=s=>{L(s),E(!1),b(-1)},P=s=>{if(!(!v||c.length===0))switch(s.key){case"ArrowDown":s.preventDefault(),b(t=>t<c.length-1?t+1:t);break;case"ArrowUp":s.preventDefault(),b(t=>t>0?t-1:-1);break;case"Enter":s.preventDefault(),z>=0&&L(c[z]),E(!1),b(-1);break;case"Escape":E(!1),b(-1);break}},T=()=>{setTimeout(()=>E(!1),150)},U=async s=>{const t=`${window.location.origin}/blog/post/${s.id}`,k={title:s.title||"Check out this post",text:s.content?s.content.substring(0,150)+(s.content.length>150?"...":""):"Check out this interesting post",url:t};if(navigator.share)try{await navigator.share(k),r()}catch(j){if(j instanceof Error&&j.name==="AbortError")return;await _(t)}else await _(t)},r=()=>{const s=document.createElement("div");s.className="share-success-toast",s.innerHTML=`
      <div class="share-success-content">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 2L11 13"></path>
          <path d="M22 2L15 22 11 13 2 9 22 2Z"></path>
        </svg>
        <span>Post shared successfully!</span>
      </div>
    `,document.body.appendChild(s),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},3e3)},_=async s=>{try{await navigator.clipboard.writeText(s),r();const t=document.createElement("div");t.className="share-success-toast clipboard-toast",t.innerHTML=`
        <div class="share-success-content">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 4h.01"></path>
            <path d="M16 20h.01"></path>
            <path d="M8 8h.01"></path>
            <path d="M8 16h.01"></path>
            <rect x="4" y="4" width="16" height="16" rx="2"></rect>
            <path d="M9 12l2 2 4-4"></path>
          </svg>
          <span>Link copied to clipboard!</span>
        </div>
      `,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)}catch{alert(`Share this link: ${s}`)}};return e.jsxs("div",{className:"blog-page",children:[e.jsx(Ve,{showSearch:!0,searchQuery:N,onSearchChange:m,onSearchKeyDown:P,onSearchBlur:T,showSuggestions:v,onSuggestionClick:d,filteredSuggestions:c,selectedSuggestionIndex:z,onSuggestionMouseEnter:b,onClearSearch:()=>{L(""),E(!1),b(-1)}}),e.jsx("main",{className:"post-content",children:e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"search-filter-section",children:e.jsxs("div",{className:"search-container",children:[e.jsx(Q,{size:20,className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Search posts by title, content, author, tags, or categories (Architectural Design, Construction, Interior Design)...",value:N,onChange:m,onKeyDown:P,onBlur:T,className:"search-input expanded",autoComplete:"off"}),N&&e.jsx("button",{className:"clear-search-btn",onClick:()=>{L(""),E(!1),b(-1)},"aria-label":"Clear search",children:e.jsx(se,{size:16})}),v&&c.length>0&&e.jsx("div",{className:"suggestions-dropdown",children:c.map((s,t)=>e.jsxs("button",{className:`suggestion-item ${t===z?"selected":""}`,onClick:()=>d(s),onMouseEnter:()=>b(t),children:[e.jsx(Q,{size:14}),e.jsx("span",{children:s})]},s))})]})}),e.jsx("div",{className:"posts-feed",children:u?e.jsx("div",{className:"loading-spinner"}):f.length===0?e.jsx("p",{className:"no-posts",children:"No posts available."}):f.map(s=>e.jsx($e,{post:s,currentUser:h,onLike:C,onShare:U},s.id))})]})})]})},Te=({videoUrl:n,poster:g})=>{const[u,M]=a.useState(!1),[h,y]=a.useState(!1),[N,L]=a.useState(!0),[p,V]=a.useState(0),[v,E]=a.useState(0),[z,b]=a.useState(!1),c=a.useRef(null),f=a.useRef(null),C=a.useRef(null);a.useEffect(()=>{const r=c.current;if(!r)return;const _=()=>V(r.duration),s=()=>E(r.currentTime),t=()=>{M(!1),y(!0)};return r.addEventListener("loadedmetadata",_),r.addEventListener("timeupdate",s),r.addEventListener("ended",t),()=>{r.removeEventListener("loadedmetadata",_),r.removeEventListener("timeupdate",s),r.removeEventListener("ended",t)}},[]);const m=async()=>{const r=c.current;if(r)try{u?(r.pause(),M(!1)):(await r.play(),M(!0),y(!0),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{y(!1)},3e3))}catch{if(!N){r.muted=!0,L(!0);try{await r.play(),M(!0),y(!0)}catch{}}}},d=()=>{const r=c.current;r&&(r.muted=!r.muted,L(r.muted))},P=r=>{const _=c.current;if(!_)return;const s=r.currentTarget.getBoundingClientRect(),j=(r.clientX-s.left)/s.width*p;_.currentTime=j,E(j)},T=()=>{const r=f.current;r&&(z?document.exitFullscreen&&document.exitFullscreen():r.requestFullscreen&&r.requestFullscreen(),b(!z))},U=r=>{const _=Math.floor(r/60),s=Math.floor(r%60);return`${_}:${s.toString().padStart(2,"0")}`};return e.jsxs("div",{ref:f,className:"facebook-video-player",onMouseEnter:()=>y(!0),onMouseLeave:()=>{u&&C.current&&clearTimeout(C.current),u||y(!1)},onClick:r=>{(r.target===r.currentTarget||r.target===c.current)&&y(!0)},children:[e.jsx("video",{ref:c,src:n,poster:g,preload:"metadata",playsInline:!0,muted:N,crossOrigin:"anonymous",className:"facebook-video-element",onError:r=>{const _=r.currentTarget;_.src!==n&&(_.src=n,_.load())}}),!u&&e.jsx("div",{className:"video-play-overlay",onClick:m,children:e.jsx("div",{className:"play-button",children:e.jsx(le,{size:60,fill:"white",stroke:"white",strokeWidth:1})})}),e.jsxs("div",{className:`video-controls ${h?"visible":""}`,children:[e.jsxs("div",{className:"progress-container",onClick:P,children:[e.jsx("div",{className:"progress-bar",style:{width:p>0?`${v/p*100}%`:"0%"}}),e.jsx("div",{className:"progress-background"})]}),e.jsxs("div",{className:"control-buttons",children:[e.jsx("button",{className:"control-btn play-pause",onClick:m,children:u?e.jsx(Ee,{size:24}):e.jsx(le,{size:24})}),e.jsxs("div",{className:"time-display",children:[e.jsx("span",{className:"current-time",children:U(v)}),e.jsx("span",{className:"time-separator",children:"/"}),e.jsx("span",{className:"duration",children:U(p)})]}),e.jsx("button",{className:"control-btn volume",onClick:d,children:N?e.jsx(_e,{size:24}):e.jsx(Le,{size:24})}),e.jsx("button",{className:"control-btn fullscreen",onClick:T,children:e.jsx(ze,{size:24})})]})]})]})},$e=({post:n,currentUser:g,onLike:u,onShare:M})=>{const[h,y]=a.useState(!1),[N,L]=a.useState([]),[p,V]=a.useState(""),[v,E]=a.useState(0),[z,b]=a.useState(!1),[c,f]=a.useState(0),[C,m]=a.useState(!1),d=n.image_url?JSON.parse(n.image_url):[],P=d.length>1,U=(i=>{if(!i)return[];try{const o=JSON.parse(i);return Array.isArray(o)?o:[o]}catch{return[i]}})(n.video_url),r=U.length>0,_=i=>{try{const x=new URL(i).pathname.toLowerCase();return/\.(mp4|webm|ogg|avi|mov|wmv|flv|m4v|3gp)$/i.test(x)}catch{return!1}},s=i=>{if(_(i))return!1;try{const x=new URL(i).hostname.toLowerCase();return x.includes("youtube.com")||x.includes("youtu.be")||x.includes("vimeo.com")||x.includes("dailymotion.com")||x.includes("tiktok.com")||x.includes("instagram.com")||x.includes("facebook.com")||x.includes("twitter.com")||x.includes("x.com")}catch{return!1}},t=i=>{try{const o=new URL(i),x=o.hostname.toLowerCase();if(x.includes("youtube.com")||x.includes("youtu.be")){let S=o.searchParams.get("v");if(!S&&x.includes("youtu.be"))S=o.pathname.split("/").pop()||null;else if(!S){const I=o.pathname.match(/\/(?:watch|embed)\/([^/?]+)/);I&&(S=I[1])}if(S)return`https://www.youtube.com/embed/${S}?autoplay=0&enablejsapi=1&modestbranding=1&rel=0`}if(x.includes("vimeo.com")){const S=o.pathname.split("/").pop();if(S&&/^\d+$/.test(S))return`https://player.vimeo.com/video/${S}?autoplay=0`}if(x.includes("tiktok.com")){const S=o.pathname.split("/"),I=S.findIndex(K=>K==="video");if(I!==-1&&S[I+1])return`https://www.tiktok.com/embed/${S[I+1]}`}if(x.includes("instagram.com")&&(o.pathname.includes("/reel/")||o.pathname.includes("/p/")))return`https://www.instagram.com${o.pathname}/embed/`;if(x.includes("facebook.com")&&o.pathname.includes("/videos/"))return`https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(i)}&show_text=false`;if(x.includes("twitter.com")||x.includes("x.com")){const S=o.pathname.match(/\/status\/(\d+)/);if(S)return`https://platform.twitter.com/embed/Tweet.html?id=${S[1]}`}if(x.includes("dailymotion.com")){const S=o.pathname.match(/\/video\/([a-zA-Z0-9]+)/);if(S)return`https://www.dailymotion.com/embed/video/${S[1]}`}return""}catch{return""}},k=a.useCallback(async()=>{try{const{data:i,error:o}=await w.from("comments").select(`
          *,
          profiles: user_id (username, full_name, avatar_url)
        `).eq("post_id",n.id).order("created_at",{ascending:!0});if(o)throw o;L(i||[])}catch{}},[n.id]);a.useEffect(()=>{h&&k()},[h,k]);const j=async()=>{if(!(!g||!p.trim()))try{const{error:i}=await w.from("comments").insert({post_id:n.id,user_id:g.id,content:p.trim()});if(i)throw i;V(""),k()}catch{}},D=()=>{E(i=>(i+1)%d.length)},A=()=>{E(i=>(i-1+d.length)%d.length)},R=(i=0)=>{f(i),b(!0)},q=()=>{b(!1)},F=()=>{f(i=>(i+1)%d.length)},Z=()=>{f(i=>(i-1+d.length)%d.length)};return e.jsxs("article",{className:"facebook-post-card",children:[e.jsx("div",{className:"post-header",children:e.jsxs("div",{className:"author-info",children:[e.jsx("div",{className:"author-avatar",children:n.author?.avatar_url?e.jsx("img",{src:n.author.avatar_url,alt:n.author.username}):e.jsx(W,{size:32})}),e.jsxs("div",{className:"author-details",children:[e.jsx("h3",{className:"author-name",children:n.author?.full_name||n.author?.username||"Anonymous"}),e.jsxs("span",{className:"post-time",children:[e.jsx(Ce,{size:14}),new Date(n.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}),e.jsxs("div",{className:"post-content",children:[n.title&&e.jsx("h4",{className:"post-title",children:n.title}),e.jsxs("div",{className:"post-text-container",children:[e.jsxs("div",{className:`post-text-wrapper ${C?"":"truncated"}`,children:[e.jsx("p",{className:"post-text",children:n.content}),!C&&n.content&&n.content.length>100&&e.jsx("button",{className:"read-more-btn",onClick:()=>m(!C),children:"Read More"})]}),C&&n.content&&n.content.length>100&&e.jsx("button",{className:"read-more-btn read-less-btn",onClick:()=>m(!C),children:"Read Less"})]})]}),d.length>0&&e.jsx("div",{className:"post-media",children:e.jsxs("div",{className:"media-container",children:[e.jsx("img",{src:d[v],alt:`Post media ${v+1}`,className:"post-media-image",onClick:()=>R(v),style:{cursor:"pointer"}}),P&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:A,children:e.jsx(ke,{size:24})}),e.jsx("button",{className:"media-nav next",onClick:D,children:e.jsx(Se,{size:24})}),e.jsx("div",{className:"image-indicators",children:d.map((i,o)=>e.jsx("button",{className:`indicator ${o===v?"active":""}`,onClick:()=>E(o)},o))}),e.jsxs("div",{className:"image-counter",children:[v+1," / ",d.length]})]})]})}),r&&e.jsx("div",{className:"post-media",children:U.map((i,o)=>{const x=_(i),I=s(i)?t(i):"";return e.jsx("div",{className:"post-video-container",children:x?e.jsx(Te,{videoUrl:i,poster:d.length>0?d[0]:void 0,index:o}):I?e.jsxs("div",{className:"external-video-wrapper",children:[e.jsx("iframe",{src:I,className:"post-media-video",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:`Video ${o+1}`,onLoad:()=>{},onError:K=>{}}),e.jsx("div",{style:{position:"absolute",bottom:"5px",right:"5px",background:"rgba(0,0,0,0.7)",color:"white",padding:"2px 6px",borderRadius:"3px",fontSize:"10px",zIndex:10},children:"External Video"})]}):e.jsx("div",{className:"video-error",children:"Unable to load video. Unsupported URL format."})},o)})}),n.tags&&n.tags.length>0&&e.jsx("div",{className:"post-tags",children:n.tags.map((i,o)=>e.jsxs("span",{className:"tag",children:["#",i]},o))}),e.jsx("div",{className:"post-stats",children:e.jsxs("div",{className:"stats-info",children:[n.likesCount>0&&e.jsxs("span",{className:"likes-count",children:[e.jsx(ie,{size:16,fill:"currentColor"}),n.likesCount]}),g&&n.commentsCount>0&&e.jsxs("span",{className:"comments-count",onClick:()=>y(!h),children:[n.commentsCount," comments"]}),!g&&n.commentsCount>0&&e.jsxs("span",{className:"comments-count disabled",children:[n.commentsCount," comments"]})]})}),e.jsxs("div",{className:"post-actions",children:[e.jsxs("button",{className:`action-btn like ${n.userLiked?"liked":""}`,onClick:()=>u(n.id),children:[e.jsx(ie,{size:18,fill:n.userLiked?"currentColor":"none"}),"Like"]}),g?e.jsxs("button",{className:"action-btn comment",onClick:()=>y(!h),children:[e.jsx(re,{size:18}),"Comment"]}):e.jsxs("button",{className:"action-btn comment disabled",onClick:()=>alert("Please log in to view comments"),children:[e.jsx(re,{size:18}),"Comment"]}),e.jsxs("button",{className:"action-btn share",onClick:()=>M(n),children:[e.jsx(ye,{size:18}),"Share"]})]}),h&&g&&e.jsxs("div",{className:"comments-section",children:[e.jsx("div",{className:"comments-list",children:N.map(i=>e.jsxs("div",{className:"comment",children:[e.jsx("div",{className:"comment-avatar",children:i.profiles?.avatar_url?e.jsx("img",{src:i.profiles.avatar_url,alt:i.profiles.username}):e.jsx(W,{size:24})}),e.jsxs("div",{className:"comment-content",children:[e.jsxs("div",{className:"comment-bubble",children:[e.jsx("strong",{children:i.profiles?.full_name||i.profiles?.username||"Anonymous"}),e.jsx("p",{children:i.content})]}),e.jsx("span",{className:"comment-time",children:new Date(i.created_at).toLocaleDateString()})]})]},i.id))}),e.jsxs("div",{className:"add-comment",children:[e.jsx("div",{className:"comment-avatar",children:g.avatar_url?e.jsx("img",{src:g.avatar_url,alt:g.username}):e.jsx(W,{size:24})}),e.jsxs("div",{className:"comment-input-container",children:[e.jsx("input",{type:"text",value:p,onChange:i=>V(i.target.value),placeholder:"Write a comment...",onKeyDown:i=>i.key==="Enter"&&j()}),e.jsx("button",{onClick:j,disabled:!p.trim(),className:"post-comment-btn",children:"Post"})]})]})]}),z&&e.jsx("div",{className:"image-modal-overlay",onClick:q,children:e.jsxs("div",{className:"image-modal-content",onClick:i=>i.stopPropagation(),children:[e.jsx("button",{className:"modal-close-btn",onClick:q,children:"×"}),e.jsxs("div",{className:"modal-image-container",children:[e.jsx("img",{src:d[c],alt:`Modal image ${c+1}`,className:"modal-image"}),d.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"modal-nav prev",onClick:Z,children:"‹"}),e.jsx("button",{className:"modal-nav next",onClick:F,children:"›"}),e.jsx("div",{className:"modal-indicators",children:d.map((i,o)=>e.jsx("button",{className:`modal-indicator ${o===c?"active":""}`,onClick:()=>f(o)},o))}),e.jsxs("div",{className:"modal-counter",children:[c+1," / ",d.length]})]})]})]})})]})};export{qe as default};
